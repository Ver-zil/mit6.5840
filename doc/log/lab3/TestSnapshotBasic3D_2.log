--------
此处省略3000行日志 iter=25
-------
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT SyncPre node:2 server:1 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 999542466553372518 179} {1 5012370221348923799 180} {1 6862908486277606481 181} {1 1868416802823627003 182} {1 183856942463225066 183} {1 2494692610658688997 184}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 999542466553372518 179} lastLog:{1 2494692610658688997 184} args:&{1 2 184 1 [{1 6691453162794206249 185} {1 8773809289924182722 186} {1 1508608195045638160 187} {1 2828140581261360103 188} {1 4133065938212469407 189} {1 6075237658346231893 190} {1 4235430248367796059 191} {1 1531124841804229508 192} {1 6776362141665079252 193}] 184}
2025/08/06 10:15:51 节点1 log rep 
2025/08/06 10:15:51 AE Access:当前节点1 当前leader:2 提交点184 日志长度193 日志复制:[{1 6691453162794206249 185} {1 8773809289924182722 186} {1 1508608195045638160 187} {1 2828140581261360103 188} {1 4133065938212469407 189} {1 6075237658346231893 190} {1 4235430248367796059 191} {1 1531124841804229508 192} {1 6776362141665079252 193}]
2025/08/06 10:15:51 follower 1 rf.nextIdx:194 rf.matchIdx:193
2025/08/06 10:15:51 Log Commit 当前leader:2 commitIdx:193
2025/08/06 10:15:51 OPT leaderEnd logCommit point:193
2025/08/06 10:15:51 OPT SyncAfter node:2 server:1 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 Replicator Signal server:1 rf.nextIdx[server]:194
2025/08/06 10:15:51 OPT HeartBeat(:true) node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 999542466553372518 179} {1 5012370221348923799 180} {1 6862908486277606481 181} {1 1868416802823627003 182} {1 183856942463225066 183} {1 2494692610658688997 184} {1 6691453162794206249 185} {1 8773809289924182722 186} {1 1508608195045638160 187} {1 2828140581261360103 188} {1 4133065938212469407 189} {1 6075237658346231893 190} {1 4235430248367796059 191} {1 1531124841804229508 192} {1 6776362141665079252 193}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 999542466553372518 179} lastLog:{1 6776362141665079252 193} args:&{1 2 193 1 [] 193}
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 Log Apply 当前节点:1 apply entries:[{1 6691453162794206249 185} {1 8773809289924182722 186} {1 1508608195045638160 187} {1 2828140581261360103 188} {1 4133065938212469407 189} {1 6075237658346231893 190} {1 4235430248367796059 191} {1 1531124841804229508 192} {1 6776362141665079252 193}]
2025/08/06 10:15:51 OPT Apply node:1 time:2025-08-06 10:15:51.910
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 Debug AE node:0 leader:2 log:[{1 <nil> 179} {1 5012370221348923799 180} {1 6862908486277606481 181} {1 1868416802823627003 182} {1 183856942463225066 183} {1 2494692610658688997 184}]
2025/08/06 10:15:51 AE State node:0 firstLog:{1 <nil> 179} lastLog:{1 2494692610658688997 184} args:&{1 2 184 1 [{1 6691453162794206249 185} {1 8773809289924182722 186} {1 1508608195045638160 187} {1 2828140581261360103 188} {1 4133065938212469407 189} {1 6075237658346231893 190} {1 4235430248367796059 191} {1 1531124841804229508 192} {1 6776362141665079252 193} {1 2440685588385645266 194}] 193}
2025/08/06 10:15:51 节点0 log rep 
2025/08/06 10:15:51 AE Access:当前节点0 当前leader:2 提交点193 日志长度194 日志复制:[{1 6691453162794206249 185} {1 8773809289924182722 186} {1 1508608195045638160 187} {1 2828140581261360103 188} {1 4133065938212469407 189} {1 6075237658346231893 190} {1 4235430248367796059 191} {1 1531124841804229508 192} {1 6776362141665079252 193} {1 2440685588385645266 194}]
2025/08/06 10:15:51 OPT SyncPre node:2 server:0 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 Log Apply 当前节点:2 apply entries:[{1 6691453162794206249 185} {1 8773809289924182722 186} {1 1508608195045638160 187} {1 2828140581261360103 188} {1 4133065938212469407 189} {1 6075237658346231893 190} {1 4235430248367796059 191} {1 1531124841804229508 192} {1 6776362141665079252 193}]
2025/08/06 10:15:51 Snapshot node:0 index:189
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.909
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.910
2025/08/06 10:15:51 Snapshot node:1 index:189
2025/08/06 10:15:51 Log Apply 当前节点:0 apply entries:[{1 6691453162794206249 185} {1 8773809289924182722 186} {1 1508608195045638160 187} {1 2828140581261360103 188} {1 4133065938212469407 189} {1 6075237658346231893 190} {1 4235430248367796059 191} {1 1531124841804229508 192} {1 6776362141665079252 193}]
2025/08/06 10:15:51 OPT Apply node:0 time:2025-08-06 10:15:51.910
2025/08/06 10:15:51 OPT Apply node:2 time:2025-08-06 10:15:51.910
2025/08/06 10:15:51 Snapshot node:2 index:189
2025/08/06 10:15:51 OPT SyncPre node:2 server:1 time:2025-08-06 10:15:51.910
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 4133065938212469407 189} {1 6075237658346231893 190} {1 4235430248367796059 191} {1 1531124841804229508 192} {1 6776362141665079252 193}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 4133065938212469407 189} lastLog:{1 6776362141665079252 193} args:&{1 2 193 1 [{1 2440685588385645266 194}] 193}
2025/08/06 10:15:51 节点1 log rep 
2025/08/06 10:15:51 AE Access:当前节点1 当前leader:2 提交点193 日志长度194 日志复制:[{1 2440685588385645266 194}]
2025/08/06 10:15:51 Install Snapshot node:0 snapshotIdxAndTerm[189, 1]
2025/08/06 10:15:51 follower 1 rf.nextIdx:195 rf.matchIdx:194
2025/08/06 10:15:51 Log Commit 当前leader:2 commitIdx:194
2025/08/06 10:15:51 OPT leaderEnd logCommit point:194
2025/08/06 10:15:51 OPT SyncAfter node:2 server:1 time:2025-08-06 10:15:51.910
2025/08/06 10:15:51 Replicator Signal server:1 rf.nextIdx[server]:195
2025/08/06 10:15:51 OPT HeartBeat(:true) node:2 time:2025-08-06 10:15:51.910
2025/08/06 10:15:51 OPT SyncAfter node:2 server:0 time:2025-08-06 10:15:51.910
2025/08/06 10:15:51 follower 0 rf.nextIdx:195 rf.matchIdx:194
2025/08/06 10:15:51 Debug AE node:0 leader:2 log:[{1 4133065938212469407 189} {1 6075237658346231893 190} {1 4235430248367796059 191} {1 1531124841804229508 192} {1 6776362141665079252 193} {1 2440685588385645266 194}]
2025/08/06 10:15:51 AE State node:0 firstLog:{1 4133065938212469407 189} lastLog:{1 2440685588385645266 194} args:&{1 2 194 1 [] 194}
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 4133065938212469407 189} {1 6075237658346231893 190} {1 4235430248367796059 191} {1 1531124841804229508 192} {1 6776362141665079252 193} {1 2440685588385645266 194}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 4133065938212469407 189} lastLog:{1 2440685588385645266 194} args:&{1 2 194 1 [] 194}
2025/08/06 10:15:51 Log Apply 当前节点:0 apply entries:[{1 2440685588385645266 194}]
2025/08/06 10:15:51 OPT Apply node:0 time:2025-08-06 10:15:51.910
2025/08/06 10:15:51 Log Apply 当前节点:2 apply entries:[{1 2440685588385645266 194}]
2025/08/06 10:15:51 OPT Apply node:2 time:2025-08-06 10:15:51.910
2025/08/06 10:15:51 Log Apply 当前节点:1 apply entries:[{1 2440685588385645266 194}]
2025/08/06 10:15:51 OPT Apply node:1 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 Replicator Signal server:0 rf.nextIdx[server]:195
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 randNumLog----------------------leader:2, crash:0
2025/08/06 10:15:51 OPT Start node:1 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 OPT SyncPre node:2 server:1 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 4133065938212469407 189} {1 6075237658346231893 190} {1 4235430248367796059 191} {1 1531124841804229508 192} {1 6776362141665079252 193} {1 2440685588385645266 194}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 4133065938212469407 189} lastLog:{1 2440685588385645266 194} args:&{1 2 194 1 [{1 6636230652060484498 195} {1 1010856095773588999 196} {1 2543609642864703911 197} {1 6548544628956534296 198} {1 7110704757269383647 199}] 194}
2025/08/06 10:15:51 节点1 log rep 
2025/08/06 10:15:51 AE Access:当前节点1 当前leader:2 提交点194 日志长度199 日志复制:[{1 6636230652060484498 195} {1 1010856095773588999 196} {1 2543609642864703911 197} {1 6548544628956534296 198} {1 7110704757269383647 199}]
2025/08/06 10:15:51 follower 1 rf.nextIdx:200 rf.matchIdx:199
2025/08/06 10:15:51 Log Commit 当前leader:2 commitIdx:199
2025/08/06 10:15:51 OPT leaderEnd logCommit point:199
2025/08/06 10:15:51 OPT SyncAfter node:2 server:1 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 Replicator Signal server:1 rf.nextIdx[server]:200
2025/08/06 10:15:51 OPT HeartBeat(:true) node:2 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 Snapshot node:2 index:199
2025/08/06 10:15:51 Install Snapshot node:0 snapshotIdxAndTerm[199, 1]
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 Replicator Signal server:1 rf.nextIdx[server]:200
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 4133065938212469407 189} {1 6075237658346231893 190} {1 4235430248367796059 191} {1 1531124841804229508 192} {1 6776362141665079252 193} {1 2440685588385645266 194} {1 6636230652060484498 195} {1 1010856095773588999 196} {1 2543609642864703911 197} {1 6548544628956534296 198} {1 7110704757269383647 199}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 4133065938212469407 189} lastLog:{1 7110704757269383647 199} args:&{1 2 199 1 [] 199}
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 Replicator Signal server:1 rf.nextIdx[server]:200
2025/08/06 10:15:51 Log Apply 当前节点:1 apply entries:[{1 6636230652060484498 195} {1 1010856095773588999 196} {1 2543609642864703911 197} {1 6548544628956534296 198} {1 7110704757269383647 199}]
2025/08/06 10:15:51 OPT Apply node:1 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 Replicator Signal server:1 rf.nextIdx[server]:200
2025/08/06 10:15:51 Log Apply 当前节点:2 apply entries:[{1 6636230652060484498 195} {1 1010856095773588999 196} {1 2543609642864703911 197} {1 6548544628956534296 198} {1 7110704757269383647 199}]
2025/08/06 10:15:51 OPT Apply node:2 time:2025-08-06 10:15:51.912
2025/08/06 10:15:51 Snapshot node:1 index:199
2025/08/06 10:15:51 OPT SyncPre node:2 server:0 time:2025-08-06 10:15:51.911
2025/08/06 10:15:51 Debug AE node:0 leader:2 log:[{1 <nil> 199}]
2025/08/06 10:15:51 AE State node:0 firstLog:{1 <nil> 199} lastLog:{1 <nil> 199} args:&{1 2 199 1 [] 199}
2025/08/06 10:15:51 OPT SyncAfter node:2 server:0 time:2025-08-06 10:15:51.912
2025/08/06 10:15:51 Replicator Signal server:0 rf.nextIdx[server]:200
2025/08/06 10:15:51 iter:26 end--------------------
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.931
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.931
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.931
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.931
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.931
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.931
2025/08/06 10:15:51 OPT SyncPre node:2 server:1 time:2025-08-06 10:15:51.931
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.931
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 7110704757269383647 199}]
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 AE State node:1 firstLog:{1 7110704757269383647 199} lastLog:{1 7110704757269383647 199} args:&{1 2 199 1 [{1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203}] 199}
2025/08/06 10:15:51 节点1 log rep 
2025/08/06 10:15:51 AE Access:当前节点1 当前leader:2 提交点199 日志长度203 日志复制:[{1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203}]
2025/08/06 10:15:51 follower 1 rf.nextIdx:204 rf.matchIdx:203
2025/08/06 10:15:51 Log Commit 当前leader:2 commitIdx:203
2025/08/06 10:15:51 OPT leaderEnd logCommit point:203
2025/08/06 10:15:51 OPT SyncAfter node:2 server:1 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 OPT SyncPre node:2 server:1 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.931
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.931
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 7110704757269383647 199} {1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 7110704757269383647 199} lastLog:{1 4759329378198235119 203} args:&{1 2 203 1 [{1 3977009299980379671 204}] 203}
2025/08/06 10:15:51 节点1 log rep 
2025/08/06 10:15:51 AE Access:当前节点1 当前leader:2 提交点203 日志长度204 日志复制:[{1 3977009299980379671 204}]
2025/08/06 10:15:51 follower 1 rf.nextIdx:205 rf.matchIdx:204
2025/08/06 10:15:51 Log Commit 当前leader:2 commitIdx:204
2025/08/06 10:15:51 OPT leaderEnd logCommit point:204
2025/08/06 10:15:51 OPT SyncAfter node:2 server:1 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 OPT SyncPre node:2 server:1 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 7110704757269383647 199} {1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 7110704757269383647 199} lastLog:{1 3977009299980379671 204} args:&{1 2 204 1 [{1 185505783990367100 205}] 204}
2025/08/06 10:15:51 节点1 log rep 
2025/08/06 10:15:51 AE Access:当前节点1 当前leader:2 提交点204 日志长度205 日志复制:[{1 185505783990367100 205}]
2025/08/06 10:15:51 follower 1 rf.nextIdx:206 rf.matchIdx:205
2025/08/06 10:15:51 Log Commit 当前leader:2 commitIdx:205
2025/08/06 10:15:51 OPT leaderEnd logCommit point:205
2025/08/06 10:15:51 OPT SyncAfter node:2 server:1 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 Replicator Signal server:1 rf.nextIdx[server]:206
2025/08/06 10:15:51 OPT HeartBeat(:true) node:2 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 7110704757269383647 199} {1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 7110704757269383647 199} lastLog:{1 185505783990367100 205} args:&{1 2 205 1 [] 205}
2025/08/06 10:15:51 OPT HeartBeat(:true) node:2 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 7110704757269383647 199} {1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 7110704757269383647 199} lastLog:{1 185505783990367100 205} args:&{1 2 205 1 [] 205}
2025/08/06 10:15:51 Log Apply 当前节点:1 apply entries:[{1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205}]
2025/08/06 10:15:51 OPT Apply node:1 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 OPT HeartBeat(:true) node:2 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 Debug AE node:0 leader:2 log:[{1 <nil> 199}]
2025/08/06 10:15:51 AE State node:0 firstLog:{1 <nil> 199} lastLog:{1 <nil> 199} args:&{1 2 199 1 [{1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205}] 205}
2025/08/06 10:15:51 节点0 log rep 
2025/08/06 10:15:51 AE Access:当前节点0 当前leader:2 提交点205 日志长度205 日志复制:[{1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205}]
2025/08/06 10:15:51 follower 0 rf.nextIdx:206 rf.matchIdx:205
2025/08/06 10:15:51 Log Apply 当前节点:0 apply entries:[{1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205}]
2025/08/06 10:15:51 OPT Apply node:0 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 Replicator Signal server:1 rf.nextIdx[server]:206
2025/08/06 10:15:51 Debug AE node:0 leader:2 log:[{1 <nil> 199} {1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205}]
2025/08/06 10:15:51 AE State node:0 firstLog:{1 <nil> 199} lastLog:{1 185505783990367100 205} args:&{1 2 205 1 [] 205}
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 randNumLog----------------------leader:2, crash:0
2025/08/06 10:15:51 OPT Start node:1 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 OPT SyncPre node:2 server:1 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 7110704757269383647 199} {1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 7110704757269383647 199} lastLog:{1 185505783990367100 205} args:&{1 2 205 1 [] 205}
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 OPT SyncPre node:2 server:0 time:2025-08-06 10:15:51.931
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.933
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.933
2025/08/06 10:15:51 Log Apply 当前节点:2 apply entries:[{1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203}]
2025/08/06 10:15:51 OPT Apply node:2 time:2025-08-06 10:15:51.933
2025/08/06 10:15:51 Log Apply 当前节点:2 apply entries:[{1 3977009299980379671 204} {1 185505783990367100 205}]
2025/08/06 10:15:51 OPT Apply node:2 time:2025-08-06 10:15:51.933
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 7110704757269383647 199} {1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 7110704757269383647 199} lastLog:{1 185505783990367100 205} args:&{1 2 205 1 [{1 552107482909122203 206} {1 6278439194331549526 207} {1 4547553441512028167 208}] 205}
2025/08/06 10:15:51 节点1 log rep 
2025/08/06 10:15:51 AE Access:当前节点1 当前leader:2 提交点205 日志长度208 日志复制:[{1 552107482909122203 206} {1 6278439194331549526 207} {1 4547553441512028167 208}]
2025/08/06 10:15:51 follower 1 rf.nextIdx:209 rf.matchIdx:208
2025/08/06 10:15:51 Log Commit 当前leader:2 commitIdx:208
2025/08/06 10:15:51 OPT leaderEnd logCommit point:208
2025/08/06 10:15:51 OPT SyncAfter node:2 server:1 time:2025-08-06 10:15:51.933
2025/08/06 10:15:51 OPT SyncPre node:2 server:1 time:2025-08-06 10:15:51.933
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 7110704757269383647 199} {1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205} {1 552107482909122203 206} {1 6278439194331549526 207} {1 4547553441512028167 208}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 7110704757269383647 199} lastLog:{1 4547553441512028167 208} args:&{1 2 208 1 [{1 2039515911135457069 209}] 208}
2025/08/06 10:15:51 节点1 log rep 
2025/08/06 10:15:51 AE Access:当前节点1 当前leader:2 提交点208 日志长度209 日志复制:[{1 2039515911135457069 209}]
2025/08/06 10:15:51 follower 1 rf.nextIdx:210 rf.matchIdx:209
2025/08/06 10:15:51 Log Commit 当前leader:2 commitIdx:209
2025/08/06 10:15:51 OPT leaderEnd logCommit point:209
2025/08/06 10:15:51 OPT SyncAfter node:2 server:1 time:2025-08-06 10:15:51.933
2025/08/06 10:15:51 Replicator Signal server:1 rf.nextIdx[server]:210
2025/08/06 10:15:51 OPT HeartBeat(:true) node:2 time:2025-08-06 10:15:51.933
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 7110704757269383647 199} {1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205} {1 552107482909122203 206} {1 6278439194331549526 207} {1 4547553441512028167 208} {1 2039515911135457069 209}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 7110704757269383647 199} lastLog:{1 2039515911135457069 209} args:&{1 2 209 1 [] 209}
2025/08/06 10:15:51 Debug AE node:0 leader:2 log:[{1 <nil> 199} {1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205}]
2025/08/06 10:15:51 AE State node:0 firstLog:{1 <nil> 199} lastLog:{1 185505783990367100 205} args:&{1 2 199 1 [{1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205}] 205}
2025/08/06 10:15:51 节点0 log rep 
2025/08/06 10:15:51 AE Access:当前节点0 当前leader:2 提交点205 日志长度205 日志复制:[{1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205}]
2025/08/06 10:15:51 follower 0 rf.nextIdx:206 rf.matchIdx:205
2025/08/06 10:15:51 Log Apply 当前节点:2 apply entries:[{1 552107482909122203 206} {1 6278439194331549526 207} {1 4547553441512028167 208} {1 2039515911135457069 209}]
2025/08/06 10:15:51 OPT Apply node:2 time:2025-08-06 10:15:51.933
2025/08/06 10:15:51 Snapshot node:2 index:209
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.932
2025/08/06 10:15:51 Log Apply 当前节点:1 apply entries:[{1 552107482909122203 206} {1 6278439194331549526 207} {1 4547553441512028167 208} {1 2039515911135457069 209}]
2025/08/06 10:15:51 OPT Apply node:1 time:2025-08-06 10:15:51.933
2025/08/06 10:15:51 Replicator Signal server:1 rf.nextIdx[server]:210
2025/08/06 10:15:51 OPT HeartBeat(:true) node:2 time:2025-08-06 10:15:51.933
2025/08/06 10:15:51 Snapshot node:1 index:209
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 2039515911135457069 209}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 2039515911135457069 209} lastLog:{1 2039515911135457069 209} args:&{1 2 209 1 [] 209}
2025/08/06 10:15:51 Debug AE node:0 leader:2 log:[{1 <nil> 199} {1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205}]
2025/08/06 10:15:51 AE State node:0 firstLog:{1 <nil> 199} lastLog:{1 185505783990367100 205} args:&{1 2 205 1 [{1 552107482909122203 206} {1 6278439194331549526 207} {1 4547553441512028167 208} {1 2039515911135457069 209}] 209}
2025/08/06 10:15:51 节点0 log rep 
2025/08/06 10:15:51 Debug AE node:0 leader:2 log:[{1 <nil> 199} {1 1764071516533513360 200} {1 5597373803038807702 201} {1 7790930592212245224 202} {1 4759329378198235119 203} {1 3977009299980379671 204} {1 185505783990367100 205} {1 552107482909122203 206} {1 6278439194331549526 207} {1 4547553441512028167 208} {1 2039515911135457069 209}]
2025/08/06 10:15:51 AE State node:0 firstLog:{1 <nil> 199} lastLog:{1 2039515911135457069 209} args:&{1 2 205 1 [{1 552107482909122203 206} {1 6278439194331549526 207} {1 4547553441512028167 208}] 205}
2025/08/06 10:15:51 节点0 log rep 
2025/08/06 10:15:51 AE Access:当前节点0 当前leader:2 提交点209 日志长度208 日志复制:[{1 552107482909122203 206} {1 6278439194331549526 207} {1 4547553441512028167 208}]
---------------
问题就出在这里了, commitIdx=209 len(rf.log)=208
核心原因在于 rf.log = append(rf.log[0:args.PrevLogIdx-curFirstLog.Index+1], args.Entries...)
这段代码每次都是把args的数据全量复制过来, 且后面的数据会被截断
但是网络会有延迟包的问题, 所以前后数据包的长度并不是单调增的, 如果是单调增的那么这个代码就没问题了
所以解决方案就是选择性复制

问题的点在于长度为208的时候, 进行snapshot的时候 rf.log[index-curFirstLogIdx:] 这个代码最后会截取一个空的slice []
发生bug的点就在这
---------------
2025/08/06 10:15:51 follower 0 rf.nextIdx:209 rf.matchIdx:208
2025/08/06 10:15:51 OPT SyncAfter node:2 server:0 time:2025-08-06 10:15:51.933
2025/08/06 10:15:51 Log Apply 当前节点:0 apply entries:[{1 552107482909122203 206} {1 6278439194331549526 207} {1 4547553441512028167 208} {1 2039515911135457069 209}]
2025/08/06 10:15:51 OPT Apply node:0 time:2025-08-06 10:15:51.934
2025/08/06 10:15:51 OPT SyncPre node:2 server:0 time:2025-08-06 10:15:51.934
2025/08/06 10:15:51 Install Snapshot node:0 snapshotIdxAndTerm[209, 1]
2025/08/06 10:15:51 AE Access:当前节点0 当前leader:2 提交点209 日志长度208 日志复制:[{1 552107482909122203 206} {1 6278439194331549526 207} {1 4547553441512028167 208} {1 2039515911135457069 209}]
2025/08/06 10:15:51 Snapshot node:0 index:209
2025/08/06 10:15:51 Install Snapshot node:0 snapshotIdxAndTerm[209, 1]
2025/08/06 10:15:51 follower 0 rf.nextIdx:210 rf.matchIdx:209
2025/08/06 10:15:51 OPT SyncAfter node:2 server:0 time:2025-08-06 10:15:51.934
2025/08/06 10:15:51 Replicator Signal server:0 rf.nextIdx[server]:210
2025/08/06 10:15:51 iter:27 end--------------------
2025/08/06 10:15:51 OPT Start node:0 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 OPT Start node:0 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 OPT Start node:0 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 OPT Start node:0 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 OPT Start node:0 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 OPT Start node:0 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 OPT Start node:0 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 OPT Start node:0 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 OPT Start node:0 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 OPT Start node:0 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 randNumLog----------------------leader:0, crash:2
2025/08/06 10:15:51 OPT Start node:1 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 OPT Start node:2 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 OPT HeartBeat(:false) node:2 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 OPT SyncPre node:2 server:1 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 OPT SyncPre node:2 server:0 time:2025-08-06 10:15:51.953
2025/08/06 10:15:51 Debug AE node:1 leader:2 log:[{1 2039515911135457069 209}]
2025/08/06 10:15:51 AE State node:1 firstLog:{1 2039515911135457069 209} lastLog:{1 2039515911135457069 209} args:&{1 2 209 1 [{1 5014792506898258595 210}] 209}
2025/08/06 10:15:51 节点1 log rep 
2025/08/06 10:15:51 AE Access:当前节点1 当前leader:2 提交点209 日志长度210 日志复制:[{1 5014792506898258595 210}]
2025/08/06 10:15:51 Debug AE node:0 leader:2 log:[]
2025/08/06 10:15:51 AE Conflict:当前节点:0 当前leader:2 冲突点209 重定位点[idx:0, term:0]
2025/08/06 10:15:51 follower 1 rf.nextIdx:211 rf.matchIdx:210
2025/08/06 10:15:51 Log Commit 当前leader:2 commitIdx:210
panic: runtime error: index out of range [0] with length 0

goroutine 1226 [running]:
6.5840/raft1.(*Raft).getFirstLog(...)
	/Users/zhanglei.verzil/Documents/coding/go/mit6.5840/src/raft1/raft.go:71
6.5840/raft1.(*Raft).AppendEntries(0x14000150000, 0x1400039a540, 0x140003974e0)
	/Users/zhanglei.verzil/Documents/coding/go/mit6.5840/src/raft1/raft.go:444 +0x6f0
reflect.Value.call({0x14000120410?, 0x1400005a170?, 0x1400022baf8?}, {0x104989249, 0x4}, {0x1400022bd10, 0x3, 0x10495ef0c?})
	/opt/homebrew/Cellar/go/1.24.5/libexec/src/reflect/value.go:584 +0x978
reflect.Value.Call({0x14000120410?, 0x1400005a170?, 0x1400005ba78?}, {0x1400022bd10?, 0x1400015ecb8?, 0x104958d14?})
	/opt/homebrew/Cellar/go/1.24.5/libexec/src/reflect/value.go:368 +0x94
6.5840/labrpc.(*Service).dispatch(0x14000010d40, {0x10498ce19, 0xd}, {{0x104a11640, 0x14000028940}, {0x10498ce14, 0x12}, {0x104a6e538, 0x104a07d80}, {0x140002f8500, ...}, ...})
	/Users/zhanglei.verzil/Documents/coding/go/mit6.5840/src/labrpc/labrpc.go:531 +0x288
6.5840/labrpc.(*Server).dispatch(0x1400000c330, {{0x104a11640, 0x14000028940}, {0x10498ce14, 0x12}, {0x104a6e538, 0x104a07d80}, {0x140002f8500, 0xe1, 0x100}, ...})
	/Users/zhanglei.verzil/Documents/coding/go/mit6.5840/src/labrpc/labrpc.go:455 +0x220
6.5840/labrpc.(*Network).processReq.func1()
	/Users/zhanglei.verzil/Documents/coding/go/mit6.5840/src/labrpc/labrpc.go:265 +0x54
created by 6.5840/labrpc.(*Network).processReq in goroutine 1225
	/Users/zhanglei.verzil/Documents/coding/go/mit6.5840/src/labrpc/labrpc.go:264 +0x1a8
exit status 2
FAIL	6.5840/raft1	2.248s

错误定位: 数据包乱序情况下
AE -> rf.log = append(rf.log[0:args.PrevLogIdx-curFirstLog.Index+1], args.Entries...)
Snapshot -> rf.log[index-curFirstLogIdx:]

修复: 
AE:
	<<<<<<<<<<<<<<
	rf.log = append(rf.log[0:args.PrevLogIdx-curFirstLog.Index+1], args.Entries...)
	--------------
	for idx, entry := range args.Entries {
		if entryIdx := entry.Index; entryIdx-curFirstLog.Index >= len(rf.log) || entry.Term != rf.log[entryIdx-curFirstLog.Index].Term {
			rf.log = append(rf.log[:entryIdx-curFirstLog.Index], args.Entries[idx:]...)
			break
		}
	}
	>>>>>>>>>>>>>>